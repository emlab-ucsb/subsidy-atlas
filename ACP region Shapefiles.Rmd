---
title: "ACP regional shapes"
author: "Matt Warham"
date: "7/16/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}

connectivity_data <- read_sf("SubsidyAtlasACP/data/ACP_eez_results/ACP_eez_mapping_wlines.shp") %>% 
  rename(eez_territory_iso3 = ez_tr_3) 

samoa <- connectivity_data %>% 
  filter(eez_territory_iso3 == "WSM")

ACP_codes_africa <- ACP_codes %>% 
  filter(region == "Africa")

ACP_codes_caribbean <- ACP_codes %>% 
  filter(region == "Caribbean")

ACP_codes_pacific <- ACP_codes %>% 
  filter(region == "Pacific")

# EEZ map
eez_map <- read_sf(dsn = here::here("SubsidyAtlasACP", "data", "eez_v10_fao_combined_simple"), layer = "eez_v10_fao_combined_simple") %>% 
  st_transform(crs = 4326) 

EEZ_map_filterAfrica <- EEZ_map %>% 
  filter(ez_hs_c %in% ACP_codes_africa$territory_iso3) %>% 
  select(c("ez_hs_c"))

EEZ_map_filterCaribbean <- EEZ_map %>% 
  filter(ez_hs_c %in% ACP_codes_caribbean$territory_iso3) %>% 
  select(c("ez_hs_c"))

EEZ_map_filterPacific <- EEZ_map %>% 
  filter(ez_hs_c %in% ACP_codes_pacific$territory_iso3) %>% 
  select(c("ez_hs_c"))

# Country map
country_map <- read_sf(dsn = here::here("SubsidyAtlasACP", "data", "world_happy_180"), layer = "world_happy_180") %>%  
  st_transform(crs = 4326) 

country_map_filterAfrica <- country_map %>% 
  dplyr::filter(iso3 %in% ACP_codes$territory_iso3) %>% 
  filter(region == "Africa") %>% 
  select(c("iso3")) %>% 
  rename(ez_hs_c = iso3)

country_map_filterCaribbean <- country_map %>% 
  dplyr::filter(iso3 %in% ACP_codes$territory_iso3) %>% 
  filter(subregn == "Caribbean") %>% 
  select(c("iso3")) %>% 
  rename(ez_hs_c = iso3)

country_map_filterPacific <- country_map %>% 
  dplyr::filter(iso3 %in% ACP_codes$territory_iso3) %>% 
  filter(region == "Oceania") %>% 
  select(c("iso3")) %>% 
  rename(ez_hs_c = iso3)

### Bind Shapefiles


africa_bind <- rbind(EEZ_map_filterAfrica, country_map_filterAfrica)
ab <- st_union(africa_bind)  
  

caribbean_bind <- rbind(EEZ_map_filterCaribbean, country_map_filterCaribbean)
cb <- st_union(caribbean_bind) 
  

pacific_bind <- rbind(EEZ_map_filterPacific, country_map_filterPacific)
pb <- st_union(pacific_bind)  
  



ggplot()+
      geom_sf(data = EEZ_map %>% dplyr::filter(is.na(zone)), fill = NA, color = "grey60", size = 0.1)+ # world EEZs (transparent, light grey border lines)
      geom_sf(data = country_map, fill = "grey2", color = "grey40", size = 0.1)+ # world countries (dark grey, white border lines)
      #geom_sf(data = country_map_filterAfrica , fill = "slateblue", alpha = 0.5, color = NA, size = 0.1) + # highlighted flag states (magenta)
      #geom_sf(data = EEZ_map_filterAfrica , fill = "slateblue", color = "grey40", size = 0.1) + # highlighted EEZ (slateblue, grey border lines)
      geom_sf(data = country_map_filterPacific, fill = "slateblue", alpha = 1, color = NA, size = 0.1) +
      maptheme+
      coord_sf(xlim = c(-180,180), ylim = c(-90,90))+
      scale_x_continuous(expand = c(0,0))+
      scale_y_continuous(expand = c(0,0))

library(leaflet)
library(RColorBrewer)


leaflet() %>% 
      addProviderTiles("CartoDB.DarkMatterNoLabels") %>% 
      addPolygons(data = ab, 
                  fillColor = "slateblue",
                  fillOpacity = 0.8,
                  color= "white",
                  weight = 0.3,
                  highlight = highlightOptions(weight = 5,
                                               color = "#666",
                                               fillOpacity = 1,
                                               bringToFront = TRUE),
                  label = ("Africa")) %>%
      addPolygons(data = cb, 
                  fillColor = "seagreen",
                  fillOpacity = 8,
                  color= "white",
                  weight = 0.3,
                  highlight = highlightOptions(weight = 5,
                                               color = "#666",
                                               fillOpacity = 1,
                                               bringToFront = TRUE),
                  label = ("Caribbean")) %>% 
    addPolygons(data = pb, 
                  fillColor = "coral",
                  fillOpacity = 8,
                  color= "white",
                  weight = 0.3,
                  highlight = highlightOptions(weight = 5,
                                               color = "#666",
                                               fillOpacity = 1,
                                               bringToFront = TRUE),
                  label = ("Pacific")) #%>% 
  # observe({
  #       click <- input$livemap_shape_click
  #       if(is.null(click))
  #           return()
  # 
  #       ## use the click to access the zoom and set the view according to these
  #       ## the click$id is now returned with the 'name' of the state
  #       ## because we specified it in the LayerId argument
  #       idx <- which(mapStates$name == click$id)
  #       z <- mapStates$zoom[[idx]]
  # 
  #       leafletProxy("livemap") %>% 
  #           setView(lng = click$lng, lat = click$lat, zoom = z)
  #   })
  


land_eez_map <- read_sf(dsn = here::here("SubsidyAtlasACP", "data", "EEZ_land_union_v2_201410"), layer = "EEZ_land_v2_201410")

leaflet() %>% 
      addProviderTiles("CartoDB.DarkMatterNoLabels") %>% 
      addPolygons(data = land_eez_map, 
                  fillColor = "slateblue",
                  fillOpacity = 0.8,
                  color= "white",
                  weight = 0.3,
                  highlight = highlightOptions(weight = 5,
                                               color = "#666",
                                               fillOpacity = 1,
                                               bringToFront = TRUE))
                  


```

```{r}

ACP_codes <- read_csv("SubsidyAtlasACP/data/ACP_eez_codes.csv") %>%
  na.omit()

ACP_codes %>% 
    select(eez_id)

ACP_codes <- eez_map %>% 
      dplyr::filter(mrgid %in% ACP_codes$eez_id)

dominica <- dw_effort_final %>% 
  filter(eez_territory_iso3 == "DMA")

cuba <-dw_effort_final %>% 
  filter(eez_territory_iso3 == "CUB")

belize <- dw_effort_final %>% 
  filter(eez_territory_iso3 == "BLZ")

```

