---
title: "Shapefile wrangling for the ACP Atlas of Distant Water Fishing"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(sf)
library(here)
library(rmapshaper)
library(mapview)
library(tidyverse)
library(countrycode)

```

## Introduction

This script details the analysis/wrangling done to create the shapefiles used in the ACP tool. 

*/ ------------ /*
*/ Data Sources /*
*/ ------------ /*

## Data

The following shapefiles were downloaded from the sources listed below and used in this analysis. 

From Marineregions.org: 
- Maritime Boundaries: World EEZs (v10, 2018-02-21)
- Marine and land zones: the union of world country boundaries and EEZ's (v2, 2014)

> Flanders Marine Institute (2018). Maritime Boundaries Geodatabase: Maritime Boundaries and Exclusive Economic Zones (200NM), version 10. Available online at http://www.marineregions.org/ https://doi.org/10.14284/312

From naturalearthdata.com: 
- 50m Cultural Vectors: Admin 0 - Details: Map Units (version 4.1.0)
- 50m Cultural Vectors: Admin 0 - Details: Map Subunits (version 4.1.0)

*/ ------------------- /*
*/ World EEZ Shapefile /*
*/ ------------------- /*

## Maritime Boundaries: World EEZs (v10, 2018-02-21)

### Preliminary edits

Prior to making the edits detailed below, some edits were done to this shapefile before importing it into R for performance reasons. 

First, we uploaded `eez_v10.shp` to mapshaper.org, and simplified it using the Visvalingam / weighted area method (shape removal prevented). 0.5% of original points were kept, and 2,235 line intersections were repaired. We then exported the resulting file out of mapshaper.org as a shapefile. A copy of this intermediate file can be found in `./data/shapefiles_edit/World_EEZ_v10_20180221_LR/eez_v10.shp`. 

We then imported the modified `eez_v10.shp` into QGIS (version 3.4.7-Madeira) and duplicated the layer. After reprojecting one of the two layers so the total extent of the map was from -360 to 360 degrees, we dissolved all polygons by all attributes. Some manual eliminations had to be made so that polygons with the same attributes did not have small slivers and/or dividing lines between them. We then exported this file out of QGIS as a shapefile. This file can be found in 
`./data/shapefiles_edit/World_EEZ_v10_20180221_LR_-360_360/eez_v10.shp`. 

The final shapefile was outputted with the following CRS: WGS 84 (EPSG:4326).

### Edits

The edits done to this shapefile primarily relate to disputed areas and joint management areas. For the purposes of data analysis and visualization, we wanted to easily be able to attribute these areas to each/all of the states involved in the dispute or responsible for management of the area. 

In order to do this, we duplicate the polygons cooresponding to disputed areas and joint management areas and assign them to all states (2-3 distinct states) involved. 

```{r}
# Load EEZ shapefile
eez_shp <- read_sf(dsn = here::here("SubsidyAtlasACP", "data", "shapefiles_edit", "World_EEZ_v10_20180221_LR_-360_360"), layer = "eez_v10") %>%
  setNames(tolower(names(.))) %>%
  st_transform(crs = 4326)
 
# Some manual edits to correct mistakes
eez_shp$sovereign1[eez_shp$mrgid == 49003] <- "China" # south china sea. listed as an overlapping claim, but with no other territories other than China
eez_shp$iso_ter2[eez_shp$mrgid == 50167] <- "SVN"
eez_shp$territory2[eez_shp$mrgid == 50167] <- "Slovenia"
eez_shp$sovereign2[eez_shp$mrgid == 50167] <- "Slovenia"

# Add iso codes for sovereign states
eez_shp_edit <- eez_shp %>%
   mutate(iso_sov1 = case_when(sovereign1 == "Comores" ~ "COM",
                              sovereign1 == "Micronesia" ~ "FSM",
                              TRUE ~ countrycode(sovereign1, "country.name", "iso3c")),
         iso_sov2 = case_when(sovereign2 == "Comores" ~ "COM",
                              TRUE ~ countrycode(sovereign2, "country.name", "iso3c")),
         iso_sov3 = countrycode(sovereign3, "country.name", "iso3c"))

#mapview::mapview(eez_shp)
```

```{r}
# Filter out disputed areas with multiple territories
eez_disputed <- eez_shp_edit %>%
  dplyr::filter(pol_type == "Overlapping claim") %>%
  mutate(iso_ter_all = case_when(!is.na(iso_ter3) ~ paste(iso_ter1, iso_ter2, iso_ter3, sep = ","),
                                 !is.na(iso_ter2) ~ paste(iso_ter1, iso_ter2, sep = ","),
                                 TRUE ~ iso_ter1))

# Expand                                  
eez_disputed_expand <- eez_disputed %>%
  separate_rows(iso_ter_all, sep = ",") %>%
  mutate(matching_entry = case_when(iso_ter1 == iso_ter_all ~ "1",
                                    iso_ter2 == iso_ter_all ~ "2",
                                    iso_ter3 == iso_ter_all ~ "3")) %>%
  mutate(iso_ter = case_when(matching_entry == "1" ~ iso_ter1,
                             matching_entry == "2" ~ iso_ter2,
                             matching_entry == "3" ~ iso_ter3),
         territory = case_when(matching_entry == "1" ~ territory1,
                             matching_entry == "2" ~ territory2,
                             matching_entry == "3" ~ territory3),
         iso_sov = case_when(matching_entry == "1" ~ iso_sov1,
                             matching_entry == "2" ~ iso_sov2,
                             matching_entry == "3" ~ iso_sov3),
         sovereign = case_when(matching_entry == "1" ~ sovereign1,
                             matching_entry == "2" ~ sovereign2,
                             matching_entry == "3" ~ sovereign3)) %>%
  dplyr::select(cat,
                mrgid,
                geoname,
                pol_type,
                iso_ter,
                territory,
                iso_sov,
                sovereign,
                x_1,
                y_1,
                geometry)
st_geometry(eez_disputed_expand) <- eez_disputed_expand$geometry

```

Starting with disputed areas (termed "overlapping claims" in this data set), we have `r nrow(eez_disputed)` regions. Of those, `r nrow(eez_disputed %>% dplyr::filter(!is.na(iso_ter3)))` involve three parties. We duplicate the polygons for these regions, assigning them to each territory involved in the dispute so we can more easily pull them up later. 

```{r}
# Filter out joint management areas with multiple territories
eez_joint <- eez_shp_edit %>%
  dplyr::filter(pol_type == "Joint regime") %>%
  mutate(iso_ter_all = case_when(!is.na(iso_ter3) ~ paste(iso_ter1, iso_ter2, iso_ter3, sep = ","),
                                 !is.na(iso_ter2) ~ paste(iso_ter1, iso_ter2, sep = ","),
                                 TRUE ~ iso_ter1))

# Expand                                  
eez_joint_expand <- eez_joint %>%
  separate_rows(iso_ter_all, sep = ",") %>%
  mutate(matching_entry = case_when(iso_ter1 == iso_ter_all ~ "1",
                                    iso_ter2 == iso_ter_all ~ "2",
                                    iso_ter3 == iso_ter_all ~ "3")) %>%
  mutate(iso_ter = case_when(matching_entry == "1" ~ iso_ter1,
                             matching_entry == "2" ~ iso_ter2,
                             matching_entry == "3" ~ iso_ter3),
         territory = case_when(matching_entry == "1" ~ territory1,
                             matching_entry == "2" ~ territory2,
                             matching_entry == "3" ~ territory3),
         iso_sov = case_when(matching_entry == "1" ~ iso_sov1,
                             matching_entry == "2" ~ iso_sov2,
                             matching_entry == "3" ~ iso_sov3),
         sovereign = case_when(matching_entry == "1" ~ sovereign1,
                             matching_entry == "2" ~ sovereign2,
                             matching_entry == "3" ~ sovereign3)) %>%
  dplyr::select(cat,
                mrgid,
                geoname,
                pol_type,
                iso_ter,
                territory,
                iso_sov,
                sovereign,
                x_1,
                y_1,
                geometry)
st_geometry(eez_joint_expand) <- eez_joint_expand$geometry

```

Next, we have `r nrow(eez_joint)` joint management areas. All involve two parties. We duplicate the polygons for these regions, assigning them to each territory involved in the dispute so we can more easily pull them up later. 

We then added these polygons back into our main data set so that each polygon is attributed to a single territory (with duplicates)

```{r}
eez_200nm <- eez_shp_edit %>%
  dplyr::filter(pol_type == "200NM") %>%
  dplyr::select(cat,
                mrgid,
                geoname,
                pol_type,
                iso_ter = iso_ter1,
                territory = territory1,
                iso_sov = iso_sov1,
                sovereign = sovereign1,
                x_1,
                y_1,
                geometry)

eez_out <- eez_200nm %>%
  rbind(eez_disputed_expand) %>%
  rbind(eez_joint_expand)

#mapview::mapview(eez_out)

write_sf(eez_out, dsn = here::here("SubsidyAtlasACP", "data", "shapefiles_edit", "World_EEZ_v10_SubsidyAtlasACP"), layer = "eez_v10", driver = "ESRI shapefile")
```

*/ -------------------------------------- /*
*/ 50m World Political Units Shapefile /*
*/ -------------------------------------- /*

## 50m World Political Units/Subunits

### Preliminary edits

Prior to making the edits detailed below, some edits were done to both shapefiles before importing a combined version into R. 

We first imported `ne_50m_admin_0_map_subunits.shp` into QGIS (version 3.4.7-Madeira) and extracted the polygon for the Crimean Peninsula. We then imported the `ne_50m_admin_0_map_units.shp` into QGIS, deleted the portion of the Russian polygon cooresponding to the Crimean Peninsula and replaced it with the polygon extracted from the subunits shapefile. We then duplicated this layer twice and reprojected the duplicate layers so the total extent was from -540 to 540 degrees longitude. We then dissolved all polygons by all attributes. Some manual eliminations had to be made so that polygons with the same attributes did not have small slivers and/or dividing lines between them. We then clipped the layer extent to -360 to 360 degrees longitude and exported this file out of QGIS as a shapefile. This file can be found in 
`./data/shapefiles_edit/ne_50m_admin_0_map_units_subunits_-360_360/land_50m.shp`. 

The final shapefile was outputted with the following CRS: WGS 84 (EPSG:4326).

### Edits

The edits done to this shapefile primarily relate to manually assigning some attributes, and joining some subunits back together.

```{r}
land_map <- read_sf(dsn = here::here("SubsidyAtlasACP", "data", "shapefiles_edit", "ne_50m_admin_0_map_units_subunits_-360_360"), 
                    layer = "land_50m") %>%
  st_transform(crs = 4326) %>%
  setNames(tolower(names(.))) %>%
  dplyr::select(sovereign = sovereignt,
                sov_iso3 = sov_a3,
                type,
                admin,
                admin_iso3 = adm0_a3,
                geounit,
                geo_iso3 = gu_a3,
                subunit,
                subunit_iso3 = su_a3,
                notes = note_brk,
                geometry) %>%
  arrange(sov_iso3, admin_iso3, geo_iso3)

```

Let's first sort out those that have the same sovereign, admin, and geounit.
 
```{r}
# Let's start with entries that have the same party listed as sovereign, admin, geounit, and subunit (193 entries)
land_same <- land_map %>%
  dplyr::filter(sovereign == admin & admin == geounit & geounit == subunit)

# Northern Cyprus - self admin, but claimed by Turkey. International community considers it to be part of Cyprus. 
land_same$sovereign[land_same$sov_iso3 == "CYN"] <- "Cyprus"
land_same$type[land_same$sov_iso3 == "CYN"] <- "Disputed"

# Kosovo - partially recognized state, claimed by Serbia. Much of international community recognizes its independance, but WTO maps include it with Serbia. We do this down below

# Western Sahara - self admin, but claimed by Morocco. International community largely does not recognize Morocco's sovereignty, but WTO maps include it with Morocco. 
land_same$sovereign[land_same$sov_iso3 == "SAH"] <- "Morocco"
land_same$type[land_same$sov_iso3 == "SAH"] <- "Disputed"

# Somaliland - self admin, but claimed by Somalia. International community considers it to be an autonomous region of Somalia
land_same$sovereign[land_same$sov_iso3 == "SOL"] <- "Somalia"
land_same$type[land_same$sov_iso3 == "SOL"] <- "Disputed"

# Taiwan - self admin, but claimed by China. Is a non-member of the WTO, separate from China. 
# Leaving as is for the time being. 

# Let's now simplify to a sovereign state and an administering state/territory. 
land_same_edit <- land_same %>%
  dplyr::select(type, 
                sovereign,
                admin,
                notes,
                geometry) 

#mapview(land_same_edit)
```

Now let's look at those entries where subunit differs.

```{r}
# Entries that have the same party listed as sovereign, admin, and geounit, but have a different subunit (2 entries)
land_subunits <- land_map %>%
  dplyr::filter(sovereign == admin & admin == geounit & geounit != subunit)

# Crimea - administered by Russia, claimed by Ukraine. International community largely recognizes Ukraine sovereignty over it
land_subunits$type[land_subunits$subunit_iso3 == "RUC"] <- "Disputed"

# United States - naming mistake? 
land_subunits$subunit[land_subunits$subunit_iso3 == "USA"] <- "United States of America"

# Let's now simplify to a sovereign state and an administering state/territory. 
land_subunits_edit <- land_subunits %>%
  dplyr::select(type, 
                sovereign,
                admin,
                notes,
                geometry) 
```

Next entries where the geounit and the subunit differ.

```{r}
# Entries that have the same party listed as sovereign and admin, but have a different geounit and subunit (26 entries)
land_geounits <- land_map %>%
  dplyr::filter(sovereign == admin & admin != geounit)

# Antigua and Barbuda - two separate islands. WTO displays the two together
antiguabarbuda <- land_geounits %>%
  dplyr::filter(sovereign == "Antigua and Barbuda") %>%
  group_by(sovereign, type, admin, notes) %>%
  summarize(geometry = st_union(geometry))
antiguabarbuda$notes <- "Islands of Antigua and Barbuda combined"

# Belgium - officially has three regions: Brussels Capital Region, Flemish Region, and Walloon Region. WTO displays the three together
belgium <- land_geounits %>%
  dplyr::filter(sovereign == "Belgium") %>%
  group_by(sovereign, type, admin, notes) %>%
  summarize(geometry = st_union(geometry))
belgium$notes <- "Brussels Capital Region, Flemish Region, and Walloon Region combined"

# Bosnia and Herzegovina (Republic Srpska) - WTO combines it with the rest of Bosnia and Herzegovina
bosnia <- land_geounits %>%
  dplyr::filter(sovereign == "Bosnia and Herzegovina") %>%
  dplyr::select(type, sovereign, admin, notes, geometry) %>%
  rbind(land_same_edit %>% dplyr::filter(sovereign == "Bosnia and Herzegovina")) %>%
  group_by(sovereign, type, admin, notes) %>%
  summarize(geometry = st_union(geometry))
bosnia$notes <- "Includes Republic Srpska"

# Guadeloupe - French overseas region. WTO does NOT display overseas regions of EU Member states as being part of the EU so these should be kept separate
land_geounits$admin[land_geounits$geounit == "Guadeloupe"] <- "Guadeloupe"

# French Guiana - French overseas region. WTO does NOT display overseas regions of EU Member states as being part of the EU so these should be kept separate
land_geounits$admin[land_geounits$geounit == "French Guiana"] <- "French Guiana"

# Martinique - French overseas region. WTO does NOT display overseas regions of EU Member states as being part of the EU so these should be kept separate
land_geounits$admin[land_geounits$geounit == "Martinique"] <- "Martinique"

# Mayotte - French overseas region. WTO does NOT display overseas regions of EU Member states as being part of the EU so these should be kept separate
land_geounits$admin[land_geounits$geounit == "Mayotte"] <- "Mayotte"
land_geounits$type[land_geounits$geounit == "Mayotte"] <- "Disputed"

# Reunion - French overseas region. WTO does NOT display overseas regions of EU Member states as being part of the EU so these should be kept separate
land_geounits$admin[land_geounits$geounit == "Reunion"] <- "Reunion"

# United Kingdom - comprised of England, Northern Ireland, Wales, and Scotland. WTO displays them together as the United Kingdom
uk <- land_geounits %>%
  dplyr::filter(sovereign == "United Kingdom") %>%
  group_by(sovereign, type, admin, notes) %>%
  summarize(geometry = st_union(geometry))
uk$notes <- "Includes England, Northern Ireland, Wales, and Scotland"

# Caribbean Netherlands - special (overseas) municipalities of the Netherlands. WTO does NOT display overseas regions of EU Member states as being part of the EU so these should be kept separate
land_geounits$admin[land_geounits$geounit == "Caribbean Netherlands"] <- "Caribbean Netherlands"

# Svalbard and Jan Mayen - remote jurisdiction of Norway. WTO displays as part of continental norway, but for consistancy with EEZ map, will keep separate
land_geounits$admin[land_geounits$geounit == "Svalbard"] <- "Svalbard"
land_geounits$admin[land_geounits$geounit == "Jan Mayen"] <- "Jan Mayen"

# Tokelau - dependancy of New Zealand. WTO does not diplay as part of New Zealand. 
land_geounits$admin[land_geounits$geounit == "Tokelau"] <- "Tokelau"

# Bougainville - autonomous region of Papua New Guina. WTO displays as part of Papua New Guina. 
png <- land_geounits %>%
  dplyr::filter(geounit == "Bougainville") %>%
  dplyr::select(type, sovereign, admin, notes, geometry) %>%
  rbind(land_same_edit %>% dplyr::filter(sovereign == "Papua New Guinea")) %>%
  group_by(sovereign, type, admin, notes) %>%
  summarize(geometry = st_union(geometry))
png$notes <- "Includes the Autonomous Region of Bougainville"

# Azores and Madeira - autonomous region of Portual. WTO does NOT display overseas regions of EU Member states as being part of the EU so these should be kept separate. 
land_geounits$admin[land_geounits$geounit == "Azores"] <- "Azores"
land_geounits$admin[land_geounits$geounit == "Madeira"] <- "Madeira"

# Republic of Serbia (Vojvodina) - Autonomous region in Serbia. WTO combines it with the rest of Serbia. Also including Kosovo
serbia <- land_geounits %>%
  dplyr::filter(sovereign == "Republic of Serbia") %>%
  dplyr::select(type, sovereign, admin, notes, geometry) %>%
  rbind(land_same_edit %>% dplyr::filter(sovereign == "Republic of Serbia")) %>%
  rbind(land_same_edit %>% dplyr::filter(sovereign == "Kosovo")) %>%
  mutate(type = "Geo unit",
         sovereign = "Republic of Serbia",
         admin = "Republic of Serbia") %>%
  group_by(sovereign, type, admin, notes) %>%
  summarize(geometry = st_union(geometry))
serbia$notes <- "Includes Kosovo and the Autonomous Province of Vojvodina"

# Zanzibar - semi-autonomous region of Tanzania. WTO combines it with the rest of Tanzania. 
tanzania <- land_geounits %>%
  dplyr::filter(sovereign == "United Republic of Tanzania") %>%
  mutate(type = "Geo unit") %>%
  group_by(sovereign, type, admin, notes) %>%
  summarize(geometry = st_union(geometry))
tanzania$notes <- "Includes the semi-autonomous region of Zanzibar"

# Now we combine again. 
combined <- antiguabarbuda %>%
  rbind(belgium) %>%
  rbind(bosnia) %>%
  rbind(uk) %>%
  rbind(png) %>%
  rbind(serbia) %>%
  rbind(tanzania)

land_geounits_edit <- land_geounits %>%
  dplyr::filter(!(sovereign %in% combined$sovereign)) %>%
  dplyr::select(type, 
                sovereign,
                admin,
                notes,
                geometry) %>%
  rbind(combined)
  
```

And finally, entries where the sovereign and admin differ.

```{r}
# Entries that have different parties listed as sovereign and admin (44 entries)
land_admin <- land_map %>%
  dplyr::filter(sovereign != admin)

# Ashmore and Cartier Islands - Australian Territory. Including with Australia
australia <- land_admin %>%
  dplyr::filter(admin == "Ashmore and Cartier Islands") %>%
  dplyr::select(type, sovereign, admin, notes, geometry) %>%
  rbind(land_same_edit %>% dplyr::filter(sovereign == "Australia")) %>%
  mutate(type = "Geo unit",
         admin = "Australia") %>%
  group_by(sovereign, type, admin, notes) %>%
  summarize(geometry = st_union(geometry))
australia$notes <- "Includes Ashmore and Cartier Islands"

# Heard Island and McDonald Islands - Australian Territory. Have own EEZ, leaving for now.

# Cocos (Keeling) Islands - Australian Territory, has own EEZ. Spliting apart from indian ocean territory
land_admin$admin[land_admin$geounit == "Cocos (Keeling) Islands"] <- "Cocos (Keeling) Islands"

# Christmas Island - Australian Territory, has own EEZ. Splitting apart from indian ocean territory
land_admin$admin[land_admin$geounit == "Christmas Island"] <- "Christmas Island"

# Norfolk Island - Australian Territory, has own EEZ, leaving for now.

# Hong Kong S.A.R./Macao S.A.R - China. Leaving for now. Do not have their own EEZs but are WTO Members indpendantly (?)

# Faroe Islands/Greenland - Denmark. WTO does NOT display overseas regions of EU Member states as being part of the EU so these should be kept separate. 

# Aland - Finland. Displayed with Finland?
finland <- land_admin %>%
  dplyr::filter(sovereign == "Finland") %>%
  dplyr::select(type, sovereign, admin, notes, geometry) %>%
  mutate(admin = "Finland") %>%
  rbind(land_same_edit %>% dplyr::filter(sovereign == "Finland")) %>%
  group_by(sovereign, type, admin, notes) %>%
  summarize(geometry = st_union(geometry))
finland$notes <- "Includes the Aland Islands"

# French dependancies. WTO does NOT display overseas regions of EU Member states as being part of the EU so these should be kept separate. 

# United Kingdom dependancies. WTO does NOT display overseas regions of EU Member states as being part of the EU so these should be kept separate.

# Palestine - Israel. WTO displays separately from Israel. Can combine Gaza and the West Bank? 
palestine <- land_admin %>%
  dplyr::filter(admin == "Palestine") %>%
  group_by(sovereign, type, admin, notes) %>%
  summarize(geometry = st_union(geometry)) 
palestine$notes <- "Includes Gaza and the West Bank"

# Siachen Glacier/Kashmir. WTO maps attribute the entire region to India... 
india <- land_admin %>%
  dplyr::filter(sovereign == "Kashmir") %>%
  dplyr::select(type, sovereign, admin, notes, geometry) %>%
  rbind(land_same_edit %>% dplyr::filter(sovereign == "India")) %>%
  mutate(type = "Geo unit",
         sovereign = "India",
         admin = "India",
         notes = "Includes the region of Kashmir. Also claimed by Pakistan") %>%
  group_by(sovereign, type, admin, notes) %>%
  summarize(geometry = st_union(geometry))

# Combine
combined2 <- finland %>%
  rbind(palestine) %>%
  rbind(india) %>%
  rbind(australia)

land_admin_edit <- land_admin %>%
  dplyr::filter(admin != "Ashmore and Cartier Islands") %>%
  dplyr::filter(sovereign != "Kashmir") %>%
  dplyr::filter(admin != "Palestine") %>%
  dplyr::filter(sovereign != "Finland") %>%
  dplyr::select(type, 
                sovereign,
                admin,
                notes,
                geometry) %>%
  rbind(combined2)

```

Now we need to put them all back together and export

```{r}
# Put them back together
land_out_raw <- land_subunits_edit %>%
  rbind(land_geounits_edit) %>%
  rbind(land_admin_edit)

# Exclude entries from our first cut that have been included elsewhere
land_same_edit_condensed <- land_same_edit %>%
  dplyr::filter(!(sovereign %in% c("Bosnia and Herzegovina",
                                 "Papua New Guinea",
                                 "Australia",
                                 "Republic of Serbia",
                                 "Kosovo",
                                 "Finland",
                                 "India")))

land_out <- land_out_raw %>%
  rbind(land_same_edit_condensed) %>%
  mutate(sov_iso3 = case_when(sovereign == "eSwatini" ~ "SWZ",
                                    TRUE ~ countrycode(sovereign, "country.name", "iso3c")),
         admin_iso3 = case_when(admin == "eSwatini" ~ "SWZ",
                                admin == "Azores" ~ "PRT",
                                admin == "Jan Mayen" ~ "SJM",
                                admin == "Madeira" ~ "PRT",
                                admin == "Saint Martin" ~ "MAF",
                                TRUE ~ countrycode(admin, "country.name", "iso3c")))


write_sf(land_out, dsn = here::here("SubsidyAtlasACP", "data", "shapefiles_edit", "ne_50m_admin_SubsidyAtlasACP"), layer = "land_50m", driver = "ESRI shapefile")

```


## Regional blocks

We also wanted to use the merged land/EEZ boundary shapefile to show the extent of our ACP states by region. The raw shapefiles used to create these was sourced from Marineregions.org (Marine and land zones: the union of world country boundaries and EEZs, Version 2 - 2014). This shapefile was last downloaded on July 31, 2019. We manually changed the extent of this shapefile in QGIS to be from -30 to 330 degrees so all of our ACP EEZs are intact. 

There are a couple of problems with using this this shapefile that need to be corrected for: 
- The Gilbert Islands are assigned to the United States Minor Outlying Islands (instead of Kiribati)
- The Phoenix Islands are assigned to the United States Minor OUtlying Islands (instead of Kiribati) and are still connected to Howland and Baker. 

These corrections were made using Version 10 of the World Maritime Boundaries (World EEZs - 2018) from Marineregions.org.

```{r}
land_eez_shp <- st_read(dsn = here::here("SubsidyAtlasACP", "data", "shapefiles_edit", "EEZ_land_union_v2_201410_-30_360_manualedits"), layer = "EEZ_land_union_v2_201410_-30_330_manualedits") %>%
  setNames(tolower(names(.)))

acp_land_eez_union <- land_eez_shp %>%
  right_join(acp_states, by = c("iso_3digit" = "territory_iso3")) %>%
      group_by(iso_3digit, region, region_specific) %>%
      summarize(geometry = st_union(geometry))

st_write(acp_land_eez_union, dsn = here::here("SubsidyAtlasACP", "data", "shapefiles_edit", "EEZ_land_union_v2_custom_ACP"), layer = "EEZ_land_union_v2_custom_ACP", driver = "ESRI Shapefile", delete_layer = T)

```